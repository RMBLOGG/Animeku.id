<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>
  <title>{% block title %}Animeku.id ‚Äî Nonton Anime Sub Indo{% endblock %}</title>
  <meta name="description" content="Nonton anime sub indo gratis, streaming kualitas HD. Animeku.id tempat wibu sejati.">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/favicon.png') }}">
  <link rel="manifest" href="/manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <script>
    // Apply theme sebelum render ‚Äî cegah flash
    (function() {
      var t = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', t);
    })();
  </script>
  <style>
    @media (max-width: 768px) {
      .desktop-auth-item { display: none !important; }
    }
  </style>

<style>
/* ‚îÄ‚îÄ NAV MORE DROPDOWN ‚îÄ‚îÄ‚îÄ */
.nav-more {
  position: relative;
}
.nav-more-btn {
  display: flex;
  align-items: center;
  padding: 6px 14px;
  border-radius: 6px;
  color: var(--text2);
  font-size: 14px;
  font-weight: 500;
  font-family: var(--font-body);
  background: none;
  border: none;
  cursor: pointer;
  transition: var(--trans);
  white-space: nowrap;
}
.nav-more-btn:hover { color: var(--text); background: rgba(255,255,255,0.06); }
.nav-more-btn.open  { color: var(--text); background: rgba(255,255,255,0.06); }

.nav-more-dropdown {
  display: none;
  position: absolute;
  top: calc(100% + 8px);
  left: 0;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius-lg);
  min-width: 170px;
  z-index: 2000;
  box-shadow: 0 12px 40px rgba(0,0,0,0.5);
  overflow: hidden;
  animation: dropIn 0.2s cubic-bezier(.22,.68,0,1.2) both;
}
.nav-more-dropdown.show { display: block; }
@keyframes dropIn {
  from { opacity:0; transform:translateY(-8px) scale(0.97); }
  to   { opacity:1; transform:none; }
}
.nav-more-item {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 16px;
  font-size: 14px;
  color: var(--text2);
  font-family: var(--font-body);
  transition: var(--trans);
  white-space: nowrap;
}
.nav-more-item:hover { background: rgba(255,255,255,0.05); color: var(--text); }
.nav-more-live { color: var(--accent) !important; font-weight: 600; }
.nav-more-live:hover { background: rgba(230,57,70,0.08) !important; }
.nav-more-divider {
  height: 1px;
  background: var(--border);
  margin: 4px 0;
}
</style>
  {% block head %}{% endblock %}
</head>
<body>

<!-- ‚îÄ‚îÄ SPLASH SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="splashScreen">
  <div class="splash-content">

    <!-- Logo animasi per huruf -->
    <div class="splash-logo" id="splashLogo">
      <span style="color:#e63946">A</span><span>N</span><span>I</span><span>M</span><span>E</span><span>K</span><span>U</span><span style="color:#e63946;font-size:0.6em">.</span><span style="color:#8b92a5;font-size:0.7em">ID</span>
    </div>

    <!-- Teks selamat datang -->
    <p class="splash-tagline" id="splashTagline">Selamat datang di dunia anime sub indo</p>

    <!-- Garis loading -->
    <div class="splash-bar"><div class="splash-bar-fill" id="splashBarFill"></div></div>

  </div>
</div>

<style>
#splashScreen {
  position: fixed;
  inset: 0;
  background: #090b0f;
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 99999;
  transition: opacity 0.6s ease, visibility 0.6s ease;
}
#splashScreen.hide {
  opacity: 0;
  visibility: hidden;
  pointer-events: none;
}
.splash-content {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 20px;
}
.splash-logo {
  font-family: 'Bebas Neue', sans-serif;
  font-size: clamp(52px, 14vw, 96px);
  letter-spacing: 4px;
  color: #f0f2f8;
  display: flex;
  align-items: baseline;
  gap: 2px;
}
.splash-logo span {
  opacity: 0;
  transform: translateY(30px) scale(0.7);
  transition: none;
}
.splash-logo span.sp-in {
  opacity: 1;
  transform: translateY(0) scale(1);
  transition: opacity 0.45s cubic-bezier(.22,.68,0,1.4),
              transform 0.45s cubic-bezier(.22,.68,0,1.4);
}
.splash-tagline {
  color: rgba(255,255,255,0.4);
  font-size: 13px;
  letter-spacing: 2px;
  text-transform: uppercase;
  font-family: 'JetBrains Mono', monospace;
  opacity: 0;
  transform: translateY(10px);
  transition: opacity 0.6s ease, transform 0.6s ease;
}
.splash-tagline.sp-in {
  opacity: 1;
  transform: translateY(0);
}
.splash-bar {
  width: 160px;
  height: 3px;
  background: rgba(255,255,255,0.08);
  border-radius: 99px;
  overflow: hidden;
  opacity: 0;
  transition: opacity 0.4s ease;
}
.splash-bar.sp-in { opacity: 1; }
.splash-bar-fill {
  height: 100%;
  width: 0%;
  background: linear-gradient(to right, #e63946, #ff6b6b);
  border-radius: 99px;
  transition: width 1.8s cubic-bezier(0.4, 0, 0.2, 1);
}
</style>

<script>
(function() {
  // Hanya tampil sekali per sesi
  if (sessionStorage.getItem('splashShown')) {
    document.getElementById('splashScreen').style.display = 'none';
    return;
  }

  sessionStorage.setItem('splashShown', '1');

  var spans = document.querySelectorAll('.splash-logo span');
  var tagline = document.getElementById('splashTagline');
  var bar = document.querySelector('.splash-bar');
  var barFill = document.getElementById('splashBarFill');

  // Animasi huruf satu per satu
  spans.forEach(function(s, i) {
    setTimeout(function() { s.classList.add('sp-in'); }, 200 + i * 80);
  });

  // Tagline muncul setelah huruf selesai
  var tagDelay = 200 + spans.length * 80 + 150;
  setTimeout(function() {
    tagline.classList.add('sp-in');
    bar.classList.add('sp-in');
    setTimeout(function() { barFill.style.width = '100%'; }, 50);
  }, tagDelay);

  // Sembunyikan splash setelah loading bar selesai
  setTimeout(function() {
    document.getElementById('splashScreen').classList.add('hide');
  }, tagDelay + 2000);
})();
</script>
<!-- ‚îÄ‚îÄ END SPLASH SCREEN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->

<!-- ‚îÄ‚îÄ POPUP PEMBERITAHUAN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
<div id="announcementOverlay" style="display:none">
  <div id="announcementModal">
    <button class="ann-close" onclick="closeAnnouncement()">√ó</button>

    <h2 class="ann-title" id="ann-title-text">Pemberitahuan !!</h2>

    <!-- Logo di bawah judul, tengah, diperbesar -->
    <div class="ann-logo">
      <img src="{{ url_for('static', filename='img/icon.png') }}" alt="ANIMEKU.ID" style="width:120px;height:120px;object-fit:contain;">
    </div>

    <p class="ann-body" id="ann-text1">
      Website ini sepenuhnya dikelola oleh <strong>Dayynime</strong>.<br>
      Kami berkomitmen menghadirkan platform streaming yang bersih, aman, dan <strong>Tanpa Iklan Sama Sekali.</strong>
    </p>
    <p class="ann-body" style="margin-top:10px" id="ann-text2">
      Jika kamu ingin <strong>Berkontribusi</strong> untuk biaya server kami,<br>
      silakan klik tombol <strong>Dukung ANIMEKU.ID</strong> di bawah. üôè
    </p>

    <!-- Tombol -->
    <div class="ann-actions">
      <div class="ann-btn-row">
        <a href="https://sociabuzz.com/dayynime/tribe" target="_blank" rel="noopener" class="ann-btn ann-btn-donate" onclick="closeAnnouncement()" id="ann-donate-btn">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg>
          <span id="ann-donate-text">Dukung</span>
        </a>
        <a href="https://www.mediafire.com/file/w66awqk0t7873go/Animeku.id.apk/file" target="_blank" rel="noopener" class="ann-btn ann-btn-apk" id="ann-apk-btn">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="currentColor"><path d="M17 2H7C5.9 2 5 2.9 5 4v16c0 1.1.9 2 2 2h10c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm-5 18c-.83 0-1.5-.67-1.5-1.5S11.17 17 12 17s1.5.67 1.5 1.5S12.83 20 12 20zm5-4H7V4h10v12z"/></svg>
          Versi APK
        </a>
      </div>
      <div class="ann-btn-row" style="margin-top:0">
        <a href="https://dayydesu.vercel.app" target="_blank" rel="noopener" class="ann-btn ann-btn-site" onclick="closeAnnouncement()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><path d="M2 12h20M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
          DayyDesu
        </a>
        <a href="https://dayystream.vercel.app" target="_blank" rel="noopener" class="ann-btn ann-btn-site" onclick="closeAnnouncement()">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="23 7 16 12 23 17 23 7"/><rect x="1" y="5" width="15" height="14" rx="2" ry="2"/></svg>
          DayyStream
        </a>
      </div>
      <button class="ann-btn ann-btn-close" onclick="closeAnnouncement()">
        Lanjut ‚Üí
      </button>
    </div>
  </div>
</div>

<style>
#announcementOverlay {
  position: fixed;
  inset: 0;
  background: rgba(0,0,0,0.75);
  backdrop-filter: blur(4px);
  z-index: 99998;
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 16px;
  opacity: 0;
  transition: opacity 0.35s ease;
}
#announcementOverlay.ann-visible { opacity: 1; }
#announcementOverlay.ann-hide {
  opacity: 0;
  pointer-events: none;
}
#announcementModal {
  background: var(--bg2, #0e1117);
  border: 1px solid rgba(230,57,70,0.2);
  border-radius: 20px;
  padding: 32px 24px 24px;
  max-width: 400px;
  width: 100%;
  position: relative;
  text-align: center;
  box-shadow: 0 24px 60px rgba(0,0,0,0.6), 0 0 0 1px rgba(255,255,255,0.04);
  transform: translateY(20px);
  transition: transform 0.35s cubic-bezier(.22,.68,0,1.2);
}
#announcementOverlay.ann-visible #announcementModal { transform: translateY(0); }
.ann-close {
  position: absolute;
  top: 14px; right: 16px;
  background: none;
  border: none;
  color: var(--text3, #555d70);
  font-size: 22px;
  cursor: pointer;
  line-height: 1;
  transition: color 0.2s;
}
.ann-close:hover { color: var(--text, #e8eaf0); }
.ann-logo {
  display: flex;
  justify-content: center;
  margin-bottom: 16px;
  margin-top: 4px;
}
.ann-title {
  font-family: 'Bebas Neue', sans-serif;
  font-size: 22px;
  letter-spacing: 2px;
  color: var(--text, #e8eaf0);
  margin-bottom: 4px;
}
.ann-body {
  font-size: 13px;
  color: var(--text2, #8b92a5);
  line-height: 1.7;
  margin: 0;
}
.ann-body strong { color: var(--text, #e8eaf0); }
.ann-actions {
  display: flex;
  flex-direction: column;
  gap: 10px;
  margin-top: 24px;
}
.ann-btn-row {
  display: flex;
  gap: 10px;
}
.ann-btn-row .ann-btn { flex: 1; }
.ann-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
  padding: 12px 16px;
  border-radius: 10px;
  font-size: 14px;
  font-weight: 600;
  cursor: pointer;
  border: none;
  text-decoration: none;
  transition: transform 0.2s, box-shadow 0.2s, opacity 0.2s;
}
.ann-btn-donate {
  background: linear-gradient(135deg, #e63946, #c0202a);
  color: #fff;
  box-shadow: 0 4px 20px rgba(230,57,70,0.35);
}
.ann-btn-donate:hover {
  transform: translateY(-2px);
  box-shadow: 0 8px 28px rgba(230,57,70,0.5);
}
.ann-btn-apk {
  background: linear-gradient(135deg, #4caf7d, #2e7d52);
  border: none !important;
  color: #fff;
  box-shadow: 0 4px 16px rgba(76,175,125,0.35);
}
.ann-btn-site {
  flex: 1;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  gap: 7px;
  padding: 11px 16px;
  border-radius: 10px;
  font-size: 13px;
  font-weight: 600;
  font-family: var(--font-body, sans-serif);
  text-decoration: none;
  transition: all 0.2s;
  background: rgba(255,255,255,0.06);
  border: 1px solid rgba(255,255,255,0.12);
  color: var(--text2, #8b92a5);
}
.ann-btn-site:hover {
  background: rgba(255,255,255,0.1);
  color: var(--text, #e8eaf0);
  transform: translateY(-1px);
}
.ann-btn-apk:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 22px rgba(76,175,125,0.5);
}
.ann-btn-close {
  background: linear-gradient(135deg, #f472b6, #db2777);
  border: none !important;
  color: #fff;
  box-shadow: 0 4px 16px rgba(244,114,182,0.35);
}
.ann-btn-close:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 22px rgba(244,114,182,0.5);
  color: #fff;
}
</style>

<script>
const _SB_URL  = "https://mafnnqttvkdgqqxczqyt.supabase.co";
const _SB_ANON = "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1hZm5ucXR0dmtkZ3FxeGN6cXl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE4NzQyMDEsImV4cCI6MjA4NzQ1MDIwMX0.YRh1oWVKnn4tyQNRbcPhlSyvr7V_1LseWN7VjcImb-Y";

async function _loadPopupConfig() {
  try {
    var res = await fetch(_SB_URL + "/rest/v1/site_config?key=eq.popup_config&select=value", {
      headers: { "apikey": _SB_ANON, "Authorization": "Bearer " + _SB_ANON }
    });
    if (!res.ok) return null;
    var data = await res.json();
    if (data.length && data[0].value) return data[0].value;
  } catch {}
  return null;
}

async function _loadSiteSettings() {
  try {
    var res = await fetch(_SB_URL + "/rest/v1/site_config?key=eq.site_settings&select=value", {
      headers: { "apikey": _SB_ANON, "Authorization": "Bearer " + _SB_ANON }
    });
    if (!res.ok) return null;
    var data = await res.json();
    if (data.length && data[0].value) return data[0].value;
  } catch {}
  return null;
}

(async function() {
  // Cek site settings dulu (maintenance mode, popup toggle)
  var settings = await _loadSiteSettings();
  
  // Maintenance mode
  if (settings && settings.maintenance) {
    if (window.location.pathname !== '/admin') {
      document.head.insertAdjacentHTML('beforeend', '<link rel="preconnect" href="https://fonts.googleapis.com"><link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Noto+Sans+JP:wght@300&family=DM+Mono:wght@300;400&display=swap" rel="stylesheet"><style>body::before{content:"";position:fixed;inset:0;background-image:url("data:image/svg+xml,%3Csvg viewBox=\'0 0 256 256\' xmlns=\'http://www.w3.org/2000/svg\'%3E%3Cfilter id=\'noise\'%3E%3CfeTurbulence type=\'fractalNoise\' baseFrequency=\'0.9\' numOctaves=\'4\' stitchTiles=\'stitch\'/%3E%3C/filter%3E%3Crect width=\'100%25\' height=\'100%25\' filter=\'url(%23noise)\' opacity=\'0.035\'/%3E%3C/svg%3E");pointer-events:none;z-index:100;opacity:.6}body::after{content:"";position:fixed;inset:0;background:repeating-linear-gradient(0deg,transparent,transparent 2px,rgba(0,0,0,.06) 2px,rgba(0,0,0,.06) 4px);pointer-events:none;z-index:99}@keyframes pulse-glow{0%,100%{opacity:.5;transform:translate(-50%,-50%) scale(1)}50%{opacity:1;transform:translate(-50%,-50%) scale(1.1)}}@keyframes kanji-flicker{0%,100%{opacity:1}48%{opacity:1}50%{opacity:.4}52%{opacity:1}88%{opacity:1}90%{opacity:.3}92%{opacity:1}}@keyframes glitch-1{0%,85%,100%{transform:none;opacity:0}87%{transform:translate(-3px,0);opacity:.7}89%{transform:translate(3px,0);opacity:.7}91%{transform:none;opacity:0}}@keyframes glitch-2{0%,85%,100%{transform:none;opacity:0}88%{transform:translate(4px,0);opacity:.6}90%{transform:translate(-2px,0);opacity:.6}92%{transform:none;opacity:0}}@keyframes fade-up{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}@keyframes progress-anim{0%{width:0%}60%{width:75%}80%{width:82%}100%{width:87%}}@keyframes blink{0%,100%{opacity:1}50%{opacity:.2}}@keyframes line-flash{0%,100%{opacity:0;width:0}50%{opacity:1;width:400px}}.mn-bg-glow{position:fixed;inset:0;pointer-events:none;overflow:hidden}.mn-bg-glow::before{content:"";position:absolute;width:600px;height:600px;border-radius:50%;background:radial-gradient(circle,rgba(230,57,70,.08) 0%,transparent 70%);top:50%;left:50%;transform:translate(-50%,-50%);animation:pulse-glow 4s ease-in-out infinite}.mn-bg-glow::after{content:"";position:absolute;width:300px;height:1px;background:linear-gradient(to right,transparent,rgba(230,57,70,.3),transparent);top:50%;left:50%;transform:translate(-50%,-50%);animation:line-flash 3s ease-in-out infinite}.mn-grid{position:fixed;inset:0;background-image:linear-gradient(rgba(255,255,255,.015) 1px,transparent 1px),linear-gradient(90deg,rgba(255,255,255,.015) 1px,transparent 1px);background-size:60px 60px;pointer-events:none}.mn-corner{position:fixed;width:60px;height:60px;pointer-events:none;z-index:10;opacity:.5}.mn-tl{top:24px;left:24px;border-top:1px solid #e63946;border-left:1px solid #e63946}.mn-tr{top:24px;right:24px;border-top:1px solid #e63946;border-right:1px solid #e63946}.mn-bl{bottom:24px;left:24px;border-bottom:1px solid #e63946;border-left:1px solid #e63946}.mn-br{bottom:24px;right:24px;border-bottom:1px solid #e63946;border-right:1px solid #e63946}.mn-kanji{font-family:"Noto Sans JP",sans-serif;font-weight:300;font-size:clamp(80px,20vw,140px);color:transparent;-webkit-text-stroke:1px rgba(230,57,70,.12);letter-spacing:-4px;line-height:1;position:absolute;top:50%;left:50%;transform:translate(-50%,-55%);white-space:nowrap;pointer-events:none;user-select:none;animation:kanji-flicker 6s ease-in-out infinite}.mn-container{position:relative;z-index:10;display:flex;flex-direction:column;align-items:center;justify-content:center;min-height:100vh;padding:40px 24px;gap:0;text-align:center}.mn-toplabel{font-family:"DM Mono",monospace;font-size:10px;font-weight:300;letter-spacing:4px;color:#3d4557;text-transform:uppercase;margin-bottom:40px;opacity:0;animation:fade-up .8s ease .2s forwards}.mn-logo{font-family:"Bebas Neue",sans-serif;font-size:clamp(18px,5vw,24px);letter-spacing:6px;color:#8b92a5;margin-bottom:48px;opacity:0;animation:fade-up .8s ease .4s forwards}.mn-logo span{color:#e63946}.mn-title{font-family:"Bebas Neue",sans-serif;font-size:clamp(52px,16vw,96px);letter-spacing:8px;line-height:.9;color:#e8eaf0;position:relative;display:inline-block}.mn-title::before,.mn-title::after{content:"MAINTENANCE";position:absolute;top:0;left:0;font-family:"Bebas Neue",sans-serif;font-size:inherit;letter-spacing:inherit}.mn-title::before{color:#e63946;clip-path:polygon(0 30%,100% 30%,100% 50%,0 50%);animation:glitch-1 4s infinite}.mn-title::after{color:#00f5ff;clip-path:polygon(0 60%,100% 60%,100% 75%,0 75%);animation:glitch-2 4s infinite}.mn-titlewrap{opacity:0;animation:fade-up .8s ease .6s forwards;margin-bottom:8px}.mn-sub{display:block;font-family:"DM Mono",monospace;font-size:clamp(10px,2.5vw,13px);letter-spacing:8px;color:#e63946;margin-top:8px;font-weight:300}.mn-divider{width:100%;max-width:320px;height:1px;background:linear-gradient(to right,transparent,rgba(230,57,70,.4),transparent);margin:32px 0;opacity:0;animation:fade-up .8s ease .8s forwards}.mn-desc{font-size:13px;font-weight:300;color:#8b92a5;line-height:2;letter-spacing:.5px;max-width:280px;opacity:0;animation:fade-up .8s ease 1s forwards}.mn-progwrap{margin-top:40px;width:100%;max-width:260px;opacity:0;animation:fade-up .8s ease 1.2s forwards}.mn-proglabel{display:flex;justify-content:space-between;font-family:"DM Mono",monospace;font-size:10px;letter-spacing:2px;color:#3d4557;margin-bottom:8px}.mn-progtrack{height:2px;background:rgba(255,255,255,.08);border-radius:99px;overflow:hidden}.mn-progfill{height:100%;width:0%;background:linear-gradient(to right,#e63946,#ff6b6b);border-radius:99px;animation:progress-anim 3s cubic-bezier(.4,0,.2,1) 2s forwards;box-shadow:0 0 8px rgba(230,57,70,.8)}.mn-statusrow{display:flex;align-items:center;gap:8px;margin-top:20px;opacity:0;animation:fade-up .8s ease 1.4s forwards}.mn-dot{width:6px;height:6px;border-radius:50%;background:#e63946;animation:blink 1.2s ease-in-out infinite}.mn-statustxt{font-family:"DM Mono",monospace;font-size:10px;letter-spacing:3px;color:#3d4557;text-transform:uppercase}.mn-bottom{position:fixed;bottom:32px;left:0;right:0;text-align:center;font-family:"DM Mono",monospace;font-size:10px;letter-spacing:3px;color:#3d4557;z-index:10;opacity:0;animation:fade-up .8s ease 1.6s forwards}</style>');
      document.body.style.cssText = 'background:#07090d;overflow:hidden;margin:0';
      document.body.innerHTML = `
        <div class="mn-bg-glow"></div>
        <div class="mn-grid"></div>
        <div class="mn-kanji">„É°„É≥„ÉÜ„Éä„É≥„Çπ</div>
        <div class="mn-corner mn-tl"></div>
        <div class="mn-corner mn-tr"></div>
        <div class="mn-corner mn-bl"></div>
        <div class="mn-corner mn-br"></div>
        <div class="mn-container">
          <div class="mn-toplabel">System Status // Offline</div>
          <div class="mn-logo"><span>A</span>NIMEKU<span>.</span>ID</div>
          <div class="mn-titlewrap">
            <div class="mn-title">MAINTENANCE</div>
            <span class="mn-sub">// PEMELIHARAAN SISTEM</span>
          </div>
          <div class="mn-divider"></div>
          <p class="mn-desc">Website sedang dalam pemeliharaan.<br>Kami akan kembali dalam waktu dekat.<br><span style="color:#3d4557">Terima kasih atas kesabaranmu üôè</span></p>
          <div class="mn-progwrap">
            <div class="mn-proglabel"><span>PROGRESS</span><span id="mn-pct">0%</span></div>
            <div class="mn-progtrack"><div class="mn-progfill" id="mn-fill"></div></div>
          </div>
          <div class="mn-statusrow">
            <div class="mn-dot"></div>
            <div class="mn-statustxt">Server dalam pemeliharaan</div>
          </div>
        </div>
        <div class="mn-bottom">ANIMEKU.ID &nbsp;¬∑&nbsp; 2026</div>
        <script>
          var cur=0,tgt=87;
          setTimeout(function(){
            var iv=setInterval(function(){
              var step=Math.ceil((tgt-cur)/8);
              cur=Math.min(cur+step,tgt);
              document.getElementById('mn-pct').textContent=cur+'%';
              if(cur>=tgt)clearInterval(iv);
            },280);
          },2000);
        <\/script>
      `;
      return;
    }
  }

  // Popup disabled?
  if (settings && settings.popup_disabled) return;

  // Tampil sekali per sesi
  if (sessionStorage.getItem('annShown')) return;
  sessionStorage.setItem('annShown', '1');

  // Load popup config dari Supabase
  var cfg = await _loadPopupConfig();
  if (cfg) {
    var titleEl = document.getElementById('ann-title-text');
    var text1El = document.getElementById('ann-text1');
    var text2El = document.getElementById('ann-text2');
    var donateBtn = document.getElementById('ann-donate-btn');
    var apkBtn    = document.getElementById('ann-apk-btn');
    var donateTxt = document.getElementById('ann-donate-text');
    if (titleEl && cfg.title)      titleEl.textContent = cfg.title;
    if (text1El && cfg.text1)      text1El.innerHTML   = cfg.text1;
    if (text2El && cfg.text2)      text2El.innerHTML   = cfg.text2;
    if (donateBtn && cfg.donateLink) donateBtn.href = cfg.donateLink;
    if (apkBtn && cfg.apkLink)       apkBtn.href    = cfg.apkLink;
    if (donateTxt && cfg.donateText) donateTxt.textContent = cfg.donateText;
  }

  var overlay = document.getElementById('announcementOverlay');
  var splashShown = sessionStorage.getItem('splashShown');
  var delay = splashShown ? 3600 : 600;

  setTimeout(function() {
    overlay.style.display = 'flex';
    requestAnimationFrame(function() {
      requestAnimationFrame(function() {
        overlay.classList.add('ann-visible');
      });
    });
  }, delay);
})();

function closeAnnouncement() {
  var overlay = document.getElementById('announcementOverlay');
  overlay.classList.add('ann-hide');
  overlay.classList.remove('ann-visible');
  setTimeout(function() { overlay.style.display = 'none'; }, 350);
}
</script>
<!-- ‚îÄ‚îÄ END POPUP PEMBERITAHUAN ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ -->
  <nav class="navbar" id="navbar">
    <div class="nav-inner">
      <a href="/" class="logo">
        <span class="logo-a">A</span>NIMEKU<span class="logo-dot">.</span><span class="logo-id">ID</span>
      </a>
      <div class="nav-links">
        <a href="/ongoing"   class="nav-link">Ongoing</a>
        <a href="/completed" class="nav-link">Completed</a>
        <a href="/movies"    class="nav-link">Movie</a>
        <a href="/popular"   class="nav-link">Populer</a>
        <a href="/jadwal"    class="nav-link">Jadwal</a>
        <a href="/genres"    class="nav-link">Genre</a>
        <!-- Dropdown Lainnya -->
        <div class="nav-more" id="navMore">
          <button class="nav-link nav-more-btn" onclick="toggleNavMore(event)">
            Lainnya
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="margin-left:3px"><path d="M6 9l6 6 6-6"/></svg>
          </button>
          <div class="nav-more-dropdown" id="navMoreDropdown">
            <a href="/koleksi" class="nav-more-item">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
              Koleksi
            </a>
            <a href="/animelist" class="nav-more-item">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M4 6h16M4 12h16M4 18h7"/></svg>
              Anime A-Z
            </a>
            <div class="nav-more-divider"></div>
            <a href="/chat" class="nav-more-item nav-more-live">
              <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
              Live Chat
            </a>
          </div>
        </div>
      </div>
      <div class="nav-right">
        <button class="nav-icon-btn" id="themeToggle" aria-label="Toggle theme" title="Ganti tema"></button>
        <button class="nav-icon-btn" id="searchToggle" aria-label="Search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>


        <!-- Desktop only: Login button & user menu (hidden on mobile via CSS) -->
        <a href="/auth/login" id="desktopBtnLogin" onclick="localStorage.setItem('auth_return_to',location.href)"
          class="desktop-auth-item"
          style="display:none;align-items:center;gap:7px;padding:7px 14px;border-radius:8px;
          background:var(--accent);color:#fff;font-size:13px;font-weight:600;transition:var(--trans);text-decoration:none">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Login
        </a>

        <div id="desktopUserMenu" class="desktop-auth-item" style="display:none;position:relative">
          <button id="desktopAvatarBtn" onclick="toggleDesktopDropdown()"
            style="display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--border);
            border-radius:8px;padding:5px 10px 5px 5px;cursor:pointer;transition:border-color 0.2s ease">
            <img id="desktopAvatar" src="" alt="" width="28" height="28" style="border-radius:50%;object-fit:cover;flex-shrink:0">
            <span id="desktopUserName" style="font-size:13px;font-weight:600;color:var(--text);max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></span>
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
          </button>
          <div id="desktopDropdown" style="display:none;position:absolute;top:calc(100% + 8px);right:0;
            background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
            min-width:160px;z-index:999;box-shadow:0 8px 32px rgba(0,0,0,0.4);overflow:hidden">
            <button onclick="logoutUser()"
              style="width:100%;display:flex;align-items:center;gap:10px;padding:11px 16px;
              background:none;border:none;color:var(--text2);font-size:13px;cursor:pointer;
              font-family:var(--font-body);transition:var(--trans);text-align:left">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Logout
            </button>
          </div>
        </div>

        <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
      </div>
    </div>

    <div class="search-bar" id="searchBar">
      <div class="search-inner">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="searchInput" placeholder="Cari anime..." autocomplete="off"/>
        <kbd>ESC</kbd>
      </div>
      <div class="search-results" id="searchResults"></div>
    </div>

    <div class="mobile-menu" id="mobileMenu">
      <a href="/ongoing">Ongoing</a>
      <a href="/completed">Completed</a>
      <a href="/movies">Movie</a>
      <a href="/popular">Populer</a>
      <a href="/jadwal">Jadwal</a>
      <a href="/genres">Genre</a>
      <a href="/koleksi">Koleksi</a>
      <a href="/animelist">Anime A-Z</a>
      <a href="/chat" style="color:var(--accent);font-weight:600">üî¥ Live Chat</a>

      <!-- Divider -->
      <div style="height:1px;background:var(--border);margin:8px 0"></div>

      <!-- Login (tampil saat belum login) -->
      <a href="/auth/login" id="menuBtnLogin" style="display:none;align-items:center;gap:10px;color:var(--accent);font-weight:600">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
        Login
      </a>

      <!-- User info (tampil saat sudah login) -->
      <div id="menuUserInfo" style="display:none">
        <div style="display:flex;align-items:center;gap:10px;padding:10px 16px;background:var(--card);border-radius:8px;border:1px solid var(--border)">
          <img id="menuAvatar" src="" alt="" width="32" height="32" style="border-radius:50%;object-fit:cover;flex-shrink:0">
          <div style="flex:1;min-width:0">
            <div id="menuUserName" style="font-size:14px;font-weight:600;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></div>
            <div style="font-size:11px;color:var(--text3)">Logged in</div>
          </div>
          <button onclick="logoutUser()" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:12px;padding:4px 8px;border-radius:6px;border:1px solid var(--border)">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <main>{% block content %}{% endblock %}</main>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-logo"><span class="logo-a">A</span>NIMEKU<span class="logo-dot">.</span><span class="logo-id">ID</span></div>
      <p class="footer-tagline">Tempat wibu sejati nonton anime sub indo üéå</p>

      <!-- Tombol Donasi -->
      <a href="https://sociabuzz.com/dayynime/tribe" target="_blank" rel="noopener" class="donate-btn">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M12 21.593c-5.63-5.539-11-10.297-11-14.402 0-3.791 3.068-5.191 5.281-5.191 1.312 0 4.151.501 5.719 4.457 1.59-3.968 4.464-4.447 5.726-4.447 2.54 0 5.274 1.621 5.274 5.181 0 4.069-5.136 8.625-11 14.402z"/></svg>
        Dukung Animeku.ID
      </a>

      <div class="footer-links">
        <a href="/ongoing">Ongoing</a>
        <a href="/completed">Completed</a>
        <a href="/movies">Movie</a>
        <a href="/jadwal">Jadwal</a>
        <a href="/genres">Genre</a>
        <a href="/koleksi">Koleksi</a>
      <a href="/animelist">Anime A-Z</a>
      </div>
<!--       <p class="footer-credit">Data dari <strong>Animasu</strong> via API Sanka Vollerei.</p> -->
    </div>
  </footer>

  <button id="backTop" aria-label="Kembali ke atas">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 15l-6-6-6 6"/></svg>
  </button>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script>
  function getUser() {
    try { return JSON.parse(localStorage.getItem('sb_user')); } catch { return null; }
  }
  function loadAuthState() {
    const user = getUser();

    // Mobile menu
    const loginBtn = document.getElementById('menuBtnLogin');
    const userInfo = document.getElementById('menuUserInfo');
    // Desktop
    const desktopLogin = document.getElementById('desktopBtnLogin');
    const desktopUserMenu = document.getElementById('desktopUserMenu');

    if (user) {
      // Mobile
      if (loginBtn) loginBtn.style.display = 'none';
      if (userInfo) {
        userInfo.style.display = 'block';
        const avatar = document.getElementById('menuAvatar');
        const name = document.getElementById('menuUserName');
        if (avatar) avatar.src = user.avatar || '';
        if (name) name.textContent = user.name;
      }
      // Desktop
      if (desktopLogin) desktopLogin.style.display = 'none';
      if (desktopUserMenu) {
        desktopUserMenu.style.display = 'block';
        const da = document.getElementById('desktopAvatar');
        const dn = document.getElementById('desktopUserName');
        if (da) da.src = user.avatar || '';
        if (dn) dn.textContent = user.name;
      }
    } else {
      // Mobile
      if (loginBtn) loginBtn.style.display = 'flex';
      if (userInfo) userInfo.style.display = 'none';
      // Desktop
      if (desktopLogin) desktopLogin.style.display = 'flex';
      if (desktopUserMenu) desktopUserMenu.style.display = 'none';
    }
  }
  function toggleDesktopDropdown() {
    const dd = document.getElementById('desktopDropdown');
    if (!dd) return;
    dd.style.display = dd.style.display === 'none' ? 'block' : 'none';
  }
  // Tutup dropdown kalau klik di luar
  document.addEventListener('click', function(e) {
    if (!e.target.closest('#desktopUserMenu')) {
      const dd = document.getElementById('desktopDropdown');
      if (dd) dd.style.display = 'none';
    }
  });
  function logoutUser() {
    localStorage.removeItem('sb_access_token');
    localStorage.removeItem('sb_user');
    location.reload();
  }
  loadAuthState();
  </script>

<script>
function toggleNavMore(e) {
  e.stopPropagation();
  var dd  = document.getElementById('navMoreDropdown');
  var btn = document.querySelector('.nav-more-btn');
  var isOpen = dd.classList.contains('show');
  dd.classList.toggle('show', !isOpen);
  btn.classList.toggle('open', !isOpen);
}
document.addEventListener('click', function(e) {
  if (!e.target.closest('#navMore')) {
    var dd  = document.getElementById('navMoreDropdown');
    var btn = document.querySelector('.nav-more-btn');
    if (dd)  dd.classList.remove('show');
    if (btn) btn.classList.remove('open');
  }
});
</script>
  {% block scripts %}{% endblock %}
</body>
</html>