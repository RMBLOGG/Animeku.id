<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}Animeku.id â€” Nonton Anime Sub Indo{% endblock %}</title>
  <meta name="description" content="Nonton anime sub indo gratis, streaming kualitas HD. Animeku.id tempat wibu sejati.">
  <link rel="icon" type="image/png" href="{{ url_for('static', filename='img/favicon.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='img/favicon.png') }}">
  <link rel="manifest" href="/manifest.json">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <script>
    // Apply theme sebelum render â€” cegah flash
    (function() {
      var t = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', t);
    })();
  </script>
  <style>
    @media (max-width: 768px) {
      .desktop-auth-item { display: none !important; }
    }
  </style>
  {% block head %}{% endblock %}
</head>
<body>
  <nav class="navbar" id="navbar">
    <div class="nav-inner">
      <a href="/" class="logo">
        <span class="logo-a">A</span>NIMEKU<span class="logo-dot">.</span><span class="logo-id">ID</span>
      </a>
      <div class="nav-links">
        <a href="/ongoing"   class="nav-link">Ongoing</a>
        <a href="/completed" class="nav-link">Completed</a>
        <a href="/movies"    class="nav-link">Movie</a>
        <a href="/popular"   class="nav-link">Populer</a>
        <a href="/jadwal"    class="nav-link">Jadwal</a>
        <a href="/genres"    class="nav-link">Genre</a>
        <a href="/koleksi"   class="nav-link">Koleksi</a>
      </div>
      <div class="nav-right">
        <button class="nav-icon-btn" id="themeToggle" aria-label="Toggle theme" title="Ganti tema"></button>
        <button class="nav-icon-btn" id="searchToggle" aria-label="Search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>
        <a href="/koleksi" class="nav-icon-btn" title="Koleksi">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </a>

        <!-- Desktop only: Login button & user menu (hidden on mobile via CSS) -->
        <a href="/auth/login" id="desktopBtnLogin" onclick="localStorage.setItem('auth_return_to',location.href)"
          class="desktop-auth-item"
          style="display:none;align-items:center;gap:7px;padding:7px 14px;border-radius:8px;
          background:var(--accent);color:#fff;font-size:13px;font-weight:600;transition:var(--trans);text-decoration:none">
          <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
          Login
        </a>

        <div id="desktopUserMenu" class="desktop-auth-item" style="display:none;position:relative">
          <button id="desktopAvatarBtn" onclick="toggleDesktopDropdown()"
            style="display:flex;align-items:center;gap:8px;background:var(--card);border:1px solid var(--border);
            border-radius:8px;padding:5px 10px 5px 5px;cursor:pointer;transition:border-color 0.2s ease">
            <img id="desktopAvatar" src="" alt="" width="28" height="28" style="border-radius:50%;object-fit:cover;flex-shrink:0">
            <span id="desktopUserName" style="font-size:13px;font-weight:600;color:var(--text);max-width:90px;overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></span>
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="var(--text3)" stroke-width="2.5"><path d="M6 9l6 6 6-6"/></svg>
          </button>
          <div id="desktopDropdown" style="display:none;position:absolute;top:calc(100% + 8px);right:0;
            background:var(--card);border:1px solid var(--border);border-radius:var(--radius);
            min-width:160px;z-index:999;box-shadow:0 8px 32px rgba(0,0,0,0.4);overflow:hidden">
            <button onclick="logoutUser()"
              style="width:100%;display:flex;align-items:center;gap:10px;padding:11px 16px;
              background:none;border:none;color:var(--text2);font-size:13px;cursor:pointer;
              font-family:var(--font-body);transition:var(--trans);text-align:left">
              <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
              Logout
            </button>
          </div>
        </div>

        <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
      </div>
    </div>

    <div class="search-bar" id="searchBar">
      <div class="search-inner">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="searchInput" placeholder="Cari anime..." autocomplete="off"/>
        <kbd>ESC</kbd>
      </div>
      <div class="search-results" id="searchResults"></div>
    </div>

    <div class="mobile-menu" id="mobileMenu">
      <a href="/ongoing">Ongoing</a>
      <a href="/completed">Completed</a>
      <a href="/movies">Movie</a>
      <a href="/popular">Populer</a>
      <a href="/jadwal">Jadwal</a>
      <a href="/genres">Genre</a>
      <a href="/koleksi">Koleksi</a>

      <!-- Divider -->
      <div style="height:1px;background:var(--border);margin:8px 0"></div>

      <!-- Login (tampil saat belum login) -->
      <a href="/auth/login" id="menuBtnLogin" style="display:none;align-items:center;gap:10px;color:var(--accent);font-weight:600">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4"/><polyline points="10 17 15 12 10 7"/><line x1="15" y1="12" x2="3" y2="12"/></svg>
        Login
      </a>

      <!-- User info (tampil saat sudah login) -->
      <div id="menuUserInfo" style="display:none">
        <div style="display:flex;align-items:center;gap:10px;padding:10px 16px;background:var(--card);border-radius:8px;border:1px solid var(--border)">
          <img id="menuAvatar" src="" alt="" width="32" height="32" style="border-radius:50%;object-fit:cover;flex-shrink:0">
          <div style="flex:1;min-width:0">
            <div id="menuUserName" style="font-size:14px;font-weight:600;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap"></div>
            <div style="font-size:11px;color:var(--text3)">Logged in</div>
          </div>
          <button onclick="logoutUser()" style="background:none;border:none;color:var(--text3);cursor:pointer;font-size:12px;padding:4px 8px;border-radius:6px;border:1px solid var(--border)">Logout</button>
        </div>
      </div>
    </div>
  </nav>

  <main>{% block content %}{% endblock %}</main>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-logo"><span class="logo-a">A</span>NIMEKU<span class="logo-dot">.</span><span class="logo-id">ID</span></div>
      <p class="footer-tagline">Tempat wibu sejati nonton anime sub indo ðŸŽŒ</p>
      <div class="footer-links">
        <a href="/ongoing">Ongoing</a>
        <a href="/completed">Completed</a>
        <a href="/movies">Movie</a>
        <a href="/jadwal">Jadwal</a>
        <a href="/genres">Genre</a>
        <a href="/koleksi">Koleksi</a>
      </div>
<!--       <p class="footer-credit">Data dari <strong>Animasu</strong> via API Sanka Vollerei.</p> -->
    </div>
  </footer>

  <button id="backTop" aria-label="Kembali ke atas">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 15l-6-6-6 6"/></svg>
  </button>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script>
  function getUser() {
    try { return JSON.parse(localStorage.getItem('sb_user')); } catch { return null; }
  }
  function loadAuthState() {
    const user = getUser();

    // Mobile menu
    const loginBtn = document.getElementById('menuBtnLogin');
    const userInfo = document.getElementById('menuUserInfo');
    // Desktop
    const desktopLogin = document.getElementById('desktopBtnLogin');
    const desktopUserMenu = document.getElementById('desktopUserMenu');

    if (user) {
      // Mobile
      if (loginBtn) loginBtn.style.display = 'none';
      if (userInfo) {
        userInfo.style.display = 'block';
        const avatar = document.getElementById('menuAvatar');
        const name = document.getElementById('menuUserName');
        if (avatar) avatar.src = user.avatar || '';
        if (name) name.textContent = user.name;
      }
      // Desktop
      if (desktopLogin) desktopLogin.style.display = 'none';
      if (desktopUserMenu) {
        desktopUserMenu.style.display = 'block';
        const da = document.getElementById('desktopAvatar');
        const dn = document.getElementById('desktopUserName');
        if (da) da.src = user.avatar || '';
        if (dn) dn.textContent = user.name;
      }
    } else {
      // Mobile
      if (loginBtn) loginBtn.style.display = 'flex';
      if (userInfo) userInfo.style.display = 'none';
      // Desktop
      if (desktopLogin) desktopLogin.style.display = 'flex';
      if (desktopUserMenu) desktopUserMenu.style.display = 'none';
    }
  }
  function toggleDesktopDropdown() {
    const dd = document.getElementById('desktopDropdown');
    if (!dd) return;
    dd.style.display = dd.style.display === 'none' ? 'block' : 'none';
  }
  // Tutup dropdown kalau klik di luar
  document.addEventListener('click', function(e) {
    if (!e.target.closest('#desktopUserMenu')) {
      const dd = document.getElementById('desktopDropdown');
      if (dd) dd.style.display = 'none';
    }
  });
  function logoutUser() {
    localStorage.removeItem('sb_access_token');
    localStorage.removeItem('sb_user');
    location.reload();
  }
  loadAuthState();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
