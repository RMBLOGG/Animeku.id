<!DOCTYPE html>
<html lang="id" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>{% block title %}Animeku.id â€” Nonton Anime Sub Indo{% endblock %}</title>
  <meta name="description" content="Nonton anime sub indo gratis, streaming kualitas HD. Animeku.id tempat wibu sejati.">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=DM+Sans:wght@300;400;500;600&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  <script>
    // Apply theme sebelum render â€” cegah flash
    (function() {
      var t = localStorage.getItem('theme') || 'dark';
      document.documentElement.setAttribute('data-theme', t);
    })();
  </script>
  {% block head %}{% endblock %}
</head>
<body>
  <nav class="navbar" id="navbar">
    <div class="nav-inner">
      <a href="/" class="logo">
        <span class="logo-a">A</span>NIMEKU<span class="logo-dot">.</span><span class="logo-id">ID</span>
      </a>
      <div class="nav-links">
        <a href="/ongoing"   class="nav-link">Ongoing</a>
        <a href="/completed" class="nav-link">Completed</a>
        <a href="/movies"    class="nav-link">Movie</a>
        <a href="/popular"   class="nav-link">Populer</a>
        <a href="/jadwal"    class="nav-link">Jadwal</a>
        <a href="/genres"    class="nav-link">Genre</a>
        <a href="/koleksi"   class="nav-link">Koleksi</a>
      </div>
      <div class="nav-right">
        <button class="nav-icon-btn" id="themeToggle" aria-label="Toggle theme" title="Ganti tema"></button>
        <button class="nav-icon-btn" id="searchToggle" aria-label="Search">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        </button>
        <a href="/koleksi" class="nav-icon-btn" title="Koleksi">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
        </a>
        <button class="hamburger" id="hamburger"><span></span><span></span><span></span></button>
        <!-- Auth -->
        <div class="nav-auth" id="navAuth">
          <a href="/auth/login" class="btn btn-primary btn-sm" id="btnLogin" style="display:none">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7z" opacity=".3"/><circle cx="12" cy="10" r="9" fill="none" stroke="currentColor" stroke-width="2"/><path d="M12 12c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm0 2c2.67 0 8 1.34 8 4v2H4v-2c0-2.66 5.33-4 8-4z"/></svg>
            Login
          </a>
          <div class="nav-user" id="navUser" style="display:none">
            <img id="navAvatar" src="" alt="" width="28" height="28" style="border-radius:50%;object-fit:cover;cursor:pointer" onclick="toggleUserMenu()">
            <div class="user-dropdown" id="userDropdown" style="display:none">
              <span id="navUserName" style="padding:10px 16px;display:block;font-weight:600;font-size:13px;color:var(--text1)"></span>
              <hr style="border-color:var(--border);margin:4px 0">
              <button onclick="logoutUser()" style="width:100%;padding:10px 16px;background:none;border:none;color:var(--text2);cursor:pointer;text-align:left;font-size:13px">Keluar</button>
            </div>
          </div>
        </div>
    </div>

    <div class="search-bar" id="searchBar">
      <div class="search-inner">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <input type="text" id="searchInput" placeholder="Cari anime..." autocomplete="off"/>
        <kbd>ESC</kbd>
      </div>
      <div class="search-results" id="searchResults"></div>
    </div>

    <div class="mobile-menu" id="mobileMenu">
      <a href="/ongoing">Ongoing</a>
      <a href="/completed">Completed</a>
      <a href="/movies">Movie</a>
      <a href="/popular">Populer</a>
      <a href="/jadwal">Jadwal</a>
      <a href="/genres">Genre</a>
      <a href="/koleksi">Koleksi</a>
    </div>
  </nav>

  <main>{% block content %}{% endblock %}</main>

  <footer class="footer">
    <div class="footer-inner">
      <div class="footer-logo"><span class="logo-a">A</span>NIMEKU<span class="logo-dot">.</span><span class="logo-id">ID</span></div>
      <p class="footer-tagline">Tempat wibu sejati nonton anime sub indo ðŸŽŒ</p>
      <div class="footer-links">
        <a href="/ongoing">Ongoing</a>
        <a href="/completed">Completed</a>
        <a href="/movies">Movie</a>
        <a href="/jadwal">Jadwal</a>
        <a href="/genres">Genre</a>
        <a href="/koleksi">Koleksi</a>
      </div>
<!--       <p class="footer-credit">Data dari <strong>Animasu</strong> via API Sanka Vollerei.</p> -->
    </div>
  </footer>

  <button id="backTop" aria-label="Kembali ke atas">
    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M18 15l-6-6-6 6"/></svg>
  </button>

  <script src="{{ url_for('static', filename='js/main.js') }}"></script>
  <script>
  // Auth state management
  async function loadAuthState() {
    const r = await fetch('/api/me');
    const {user} = await r.json();
    if (user) {
      document.getElementById('btnLogin').style.display = 'none';
      document.getElementById('navUser').style.display = 'flex';
      document.getElementById('navAvatar').src = user.avatar || '';
      document.getElementById('navUserName').textContent = user.name;
    } else {
      document.getElementById('btnLogin').style.display = 'flex';
      document.getElementById('navUser').style.display = 'none';
    }
  }
  function toggleUserMenu() {
    const d = document.getElementById('userDropdown');
    d.style.display = d.style.display === 'none' ? 'block' : 'none';
  }
  async function logoutUser() {
    await fetch('/auth/logout', {method:'POST'});
    location.reload();
  }
  document.addEventListener('click', (e) => {
    if (!e.target.closest('#navUser')) {
      const d = document.getElementById('userDropdown');
      if (d) d.style.display = 'none';
    }
  });
  loadAuthState();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
