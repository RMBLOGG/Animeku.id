<!DOCTYPE html>
<html>
<head><title>Login...</title></head>
<body>
<script>
const hash = window.location.hash.substring(1);
const params = new URLSearchParams(hash);
const access_token = params.get('access_token');

if (access_token) {
  const payload = JSON.parse(atob(access_token.split('.')[1]));
  const user = {
    id: payload.sub,
    email: payload.email,
    name: (payload.user_metadata && payload.user_metadata.full_name) || payload.email,
    avatar: (payload.user_metadata && payload.user_metadata.avatar_url) || ''
  };

  localStorage.setItem('sb_access_token', access_token);
  localStorage.setItem('sb_user', JSON.stringify(user));

  const returnTo = localStorage.getItem('auth_return_to') || '/';
  localStorage.removeItem('auth_return_to');
  window.location.href = returnTo;
} else {
  window.location.href = '/';
}
</script>
<p style="font-family:sans-serif;text-align:center;padding-top:100px;color:#666">Sedang login...</p>
</body>
</html>
