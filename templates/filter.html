{% extends "base.html" %}
{% block title %}Filter Anime — Animeku.id{% endblock %}
{% block content %}
<div class="filter-bar">
  <div class="filter-bar-inner">
    <h1 class="page-header-title" style="margin-bottom:20px">Filter <span style="color:var(--accent)">Anime</span></h1>
    <form class="filter-form" action="/filter" method="get">
      <div class="filter-group">
        <label class="filter-label">Genre</label>
        <select name="genre" class="filter-select">
          <option value="">Semua Genre</option>
          {% if genres and genres.genres %}
            {% for g in genres.genres %}
            <option value="{{ g.slug }}" {% if params.get('genre') == g.slug %}selected{% endif %}>{{ g.name }}</option>
            {% endfor %}
          {% endif %}
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Tipe</label>
        <select name="type" class="filter-select">
          <option value="">Semua Tipe</option>
          {% for t in ['TV','Movie','OVA','ONA','Special'] %}
          <option value="{{ t }}" {% if params.get('type') == t %}selected{% endif %}>{{ t }}</option>
          {% endfor %}
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Status</label>
        <select name="status" class="filter-select">
          <option value="">Semua Status</option>
          <option value="ongoing" {% if params.get('status') == 'ongoing' %}selected{% endif %}>Ongoing</option>
          <option value="completed" {% if params.get('status') == 'completed' %}selected{% endif %}>Completed</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Urutan</label>
        <select name="order" class="filter-select">
          <option value="">Default</option>
          <option value="title" {% if params.get('order') == 'title' %}selected{% endif %}>A-Z</option>
          <option value="latest" {% if params.get('order') == 'latest' %}selected{% endif %}>Terbaru</option>
          <option value="popular" {% if params.get('order') == 'popular' %}selected{% endif %}>Populer</option>
        </select>
      </div>
      <div class="filter-group">
        <label class="filter-label">Kata Kunci</label>
        <input type="text" name="q" class="filter-input" placeholder="Nama anime..." value="{{ params.get('q','') }}">
      </div>
      <button type="submit" class="btn btn-primary">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        Cari
      </button>
      <a href="/filter" class="btn btn-ghost">Reset</a>
    </form>
  </div>
</div>

<section class="section">
  <div class="container">
    {% if data and data.animes %}
      <div class="section-header" style="margin-bottom:20px">
        <h2 class="section-title">Hasil Filter</h2>
        <span style="color:var(--text3);font-size:13px">{{ data.animes | length }} anime ditemukan</span>
      </div>
      <div class="anime-grid lg stagger">
        {% for anime in data.animes %}
        <a href="/anime/{{ anime.slug }}" class="anime-card">
          <div class="card-poster">
            <img src="{{ anime.poster }}" alt="{{ anime.title }}" loading="lazy" onerror="this.src='/static/img/placeholder.svg'">
            <div class="card-overlay"><div class="play-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg></div></div>
            {% if anime.episode %}<span class="card-badge">{{ anime.episode }}</span>{% endif %}
            {% if anime.type %}<span class="card-badge type">{{ anime.type }}</span>{% endif %}
          </div>
          <div class="card-info">
            <div class="card-title">{{ anime.title }}</div>
            <div class="card-meta"><span class="card-status">{{ anime.status_or_day }}</span></div>
          </div>
        </a>
        {% endfor %}
      </div>
      {% if data.pagination %}
      <div class="pagination">
        {% if data.pagination.hasPrev %}<a href="?{{ params | urlencode }}&page={{ (params.get('page',1)|int) - 1 }}" class="page-btn">←</a>{% endif %}
        <span class="page-btn active">{{ data.pagination.currentPage }}</span>
        {% if data.pagination.hasNext %}<a href="?{{ params | urlencode }}&page={{ (params.get('page',1)|int) + 1 }}" class="page-btn">→</a>{% endif %}
      </div>
      {% endif %}
    {% elif params %}
      <div class="empty-state">
        <h3>Tidak ada hasil</h3>
        <p>Coba ubah filter pencarian</p>
      </div>
    {% else %}
      <div class="empty-state">
        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.35-4.35"/></svg>
        <h3>Gunakan filter di atas</h3>
        <p>Pilih genre, tipe, atau status untuk menemukan anime</p>
      </div>
    {% endif %}
  </div>
</section>
{% endblock %}
