{% extends "base.html" %}
{% block title %}Jadwal Tayang â€” Animeku.id{% endblock %}
{% block content %}

<div class="page-header">
  <div class="page-header-inner">
    <h1 class="page-header-title">Jadwal <span>Tayang</span></h1>
    <p class="page-header-sub">Jadwal rilis anime mingguan</p>
  </div>
</div>

{% if data and data.schedule %}

{# Kumpulkan semua nama hari #}
{% set days = data.schedule.keys() | list %}

<!-- DAY PICKER TABS -->
<div class="schedule-strip">
  <div class="schedule-days" id="dayTabs">
    {% for day in days %}
    <button class="day-pill {% if loop.first %}active{% endif %}"
      data-day="{{ day }}" onclick="switchDay(this, '{{ day }}')">
      {{ day }}
    </button>
    {% endfor %}
  </div>
</div>

<!-- SCHEDULE CONTENT -->
<div class="schedule-content">
  {% for day, animes in data.schedule.items() %}
  <div class="schedule-day-panel {% if not loop.first %}hidden{% endif %}" id="day-{{ day }}">

    <div style="margin-bottom:18px;display:flex;align-items:center;gap:10px">
      <div style="width:4px;height:22px;background:var(--accent);border-radius:2px"></div>
      <h2 style="font-family:var(--font-head);font-size:22px;letter-spacing:1px;color:var(--text)">{{ day | upper }}</h2>
      <span style="font-size:12px;color:var(--text3);font-family:var(--font-mono);background:var(--card);
        border:1px solid var(--border);padding:3px 10px;border-radius:20px">{{ animes | length }} anime</span>
    </div>

    <div class="schedule-anime-grid">
      {% for item in animes %}
      <a href="/anime/{{ item.slug }}" class="schedule-anime-card">
        <div class="schedule-anime-poster">
          {% if item.poster %}
          <img src="{{ item.poster }}" alt="{{ item.title }}" loading="lazy"
            onerror="this.parentElement.innerHTML='<div class=\'sched-poster-fallback\'>?</div>'">
          {% else %}
          <div class="sched-poster-fallback">?</div>
          {% endif %}
          {% if item.episode %}
          <div class="sched-ep-badge">{{ item.episode }}</div>
          {% endif %}
        </div>
        <div class="schedule-anime-info">
          <div class="schedule-anime-title">{{ item.title }}</div>
          {% if item.time %}
          <div class="schedule-anime-time">
            <svg width="11" height="11" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
            {{ item.time }}
          </div>
          {% endif %}
        </div>
      </a>
      {% endfor %}
    </div>

  </div>
  {% endfor %}
</div>

{% else %}
<div class="container">
  <div class="empty-state"><h3>Jadwal tidak tersedia</h3></div>
</div>
{% endif %}

<style>
.schedule-anime-grid {
  display: grid;
  grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
  gap: 14px;
}
.schedule-anime-card {
  display: flex;
  flex-direction: column;
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  overflow: hidden;
  transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease;
  text-decoration: none;
  color: inherit;
}
.schedule-anime-card:hover {
  transform: translateY(-4px);
  border-color: rgba(230,57,70,0.35);
  box-shadow: 0 12px 32px rgba(0,0,0,0.4);
}
.schedule-anime-poster {
  position: relative;
  aspect-ratio: 2/3;
  overflow: hidden;
  background: var(--bg3);
}
.schedule-anime-poster img {
  width: 100%; height: 100%;
  object-fit: cover;
  transition: transform 0.3s ease;
}
.schedule-anime-card:hover .schedule-anime-poster img {
  transform: scale(1.05);
}
.sched-poster-fallback {
  width: 100%; height: 100%;
  display: flex; align-items: center; justify-content: center;
  font-size: 32px; color: var(--text3);
}
.sched-ep-badge {
  position: absolute;
  top: 8px; left: 8px;
  background: var(--accent);
  color: #fff;
  font-size: 10px;
  font-weight: 700;
  padding: 2px 8px;
  border-radius: 4px;
  font-family: var(--font-mono);
}
.schedule-anime-info {
  padding: 10px 10px 12px;
  display: flex;
  flex-direction: column;
  gap: 5px;
}
.schedule-anime-title {
  font-size: 12px;
  font-weight: 600;
  color: var(--text);
  line-height: 1.4;
  display: -webkit-box;
  -webkit-line-clamp: 2;
  -webkit-box-orient: vertical;
  overflow: hidden;
}
.schedule-anime-time {
  display: flex;
  align-items: center;
  gap: 4px;
  font-size: 11px;
  color: var(--accent);
  font-family: var(--font-mono);
}
.schedule-day-panel { padding-bottom: 48px; }

@media (max-width: 480px) {
  .schedule-anime-grid {
    grid-template-columns: repeat(3, 1fr);
    gap: 10px;
  }
}
</style>

<script>
function switchDay(btn, day) {
  // Update pills
  document.querySelectorAll('.day-pill').forEach(p => p.classList.remove('active'));
  btn.classList.add('active');
  // Update panels
  document.querySelectorAll('.schedule-day-panel').forEach(p => p.classList.add('hidden'));
  const panel = document.getElementById('day-' + day);
  if (panel) panel.classList.remove('hidden');
  // Scroll pill ke tengah
  btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
}

// Auto-aktifkan hari ini
(function() {
  const hariMap = {
    0: 'minggu', 1: 'senin', 2: 'selasa', 3: 'rabu',
    4: 'kamis', 5: 'jumat', 6: 'sabtu'
  };
  const todayKey = hariMap[new Date().getDay()];
  const pills = document.querySelectorAll('.day-pill');
  pills.forEach(p => {
    if (p.dataset.day.toLowerCase().includes(todayKey)) {
      p.click();
    }
  });
})();
</script>

{% endblock %}
