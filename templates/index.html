{% extends "base.html" %}
{% block title %}Animeku.id â€” Nonton Anime Sub Indo Gratis{% endblock %}

{% block content %}

<!-- HERO -->
{% if data and data.ongoing %}
{% set featured = data.ongoing[0] %}
<section class="hero hero-v2">
  <div class="hero-backdrop" id="heroBg" style="background-image: url('{{ featured.poster }}')"></div>
  <div class="hero-overlay"></div>

  <div class="hero-inner container">
    <div class="hero-poster-wrap">
      <img src="{{ featured.poster }}" alt="{{ featured.title }}" class="hero-poster-img" id="heroPosterImg">
      <div class="hero-poster-glow"></div>
    </div>

    <div class="hero-content">
      <div class="hero-badge">
        <svg width="10" height="10" viewBox="0 0 24 24" fill="currentColor"><circle cx="12" cy="12" r="10"/></svg>
        SEDANG TAYANG
      </div>
      <h1 class="hero-title" id="heroTitle">{{ featured.title }}</h1>
      <div class="hero-meta-row" id="heroMeta">
        {% if featured.type %}<span class="hero-tag">{{ featured.type }}</span>{% endif %}
        {% if featured.episode %}<span class="hero-tag accent">{{ featured.episode }}</span>{% endif %}
        <span class="hero-tag fire">{{ featured.status_or_day }}</span>
      </div>
      <p class="hero-desc">Nonton anime sub indo terlengkap & terbaru. Streaming gratis kualitas HD langsung di browser kamu.</p>
      <div class="hero-actions">
        <a href="/anime/{{ featured.slug }}" class="btn btn-primary" id="heroLink">
          <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>
          Tonton Sekarang
        </a>
        <a href="/ongoing" class="btn btn-ghost">Lihat Semua Ongoing</a>
      </div>
    </div>
  </div>

  <!-- Dots -->
  <div class="hero-dots">
    {% for anime in data.ongoing[:5] %}
    <button class="hero-dot {% if loop.first %}active{% endif %}" data-index="{{ loop.index0 }}"></button>
    {% endfor %}
  </div>
</section>

<style>
.hero-dots { position:absolute; bottom:18px; left:50%; transform:translateX(-50%); display:flex; gap:8px; z-index:10; }
.hero-dot { width:8px; height:8px; border-radius:50%; background:rgba(255,255,255,0.35); border:none; cursor:pointer; transition:all 0.3s; padding:0; }
.hero-dot.active { background:#e53935; width:24px; border-radius:4px; }
#heroPosterImg { transition: opacity 0.4s ease; }
</style>

<script>
const heroAnimes = [
  {% for anime in data.ongoing[:5] %}
  {
    poster: "{{ anime.poster }}",
    title: {{ anime.title | tojson }},
    type: "{{ anime.type }}",
    episode: "{{ anime.episode }}",
    day: "{{ anime.status_or_day }}",
    slug: "{{ anime.slug }}"
  }{% if not loop.last %},{% endif %}
  {% endfor %}
];

let heroCurrent = 0;

function heroGoTo(n) {
  heroCurrent = (n + heroAnimes.length) % heroAnimes.length;
  const a = heroAnimes[heroCurrent];
  const img = document.getElementById('heroPosterImg');

  img.style.opacity = '0';
  setTimeout(() => {
    document.getElementById('heroBg').style.backgroundImage = `url('${a.poster}')`;
    img.src = a.poster;
    img.alt = a.title;
    img.style.opacity = '1';
  }, 300);

  document.getElementById('heroTitle').textContent = a.title;
  document.getElementById('heroLink').href = `/anime/${a.slug}`;
  document.getElementById('heroMeta').innerHTML =
    (a.type ? `<span class="hero-tag">${a.type}</span>` : '') +
    (a.episode ? `<span class="hero-tag accent">${a.episode}</span>` : '') +
    `<span class="hero-tag fire">${a.day}</span>`;

  document.querySelectorAll('.hero-dot').forEach((d, i) => d.classList.toggle('active', i === heroCurrent));
}

document.querySelectorAll('.hero-dot').forEach(d => {
  d.addEventListener('click', () => { heroGoTo(+d.dataset.index); resetHeroTimer(); });
});

let heroTimer = setInterval(() => heroGoTo(heroCurrent + 1), 5000);
function resetHeroTimer() { clearInterval(heroTimer); heroTimer = setInterval(() => heroGoTo(heroCurrent + 1), 5000); }
</script>
{% endif %}

<!-- SCHEDULE STRIP -->
{% if schedule %}
<div class="schedule-strip">
  <div class="schedule-days" id="scheduleDays">
    {% set days = schedule.schedule.keys() | list if schedule.schedule else [] %}
    {% for day in days %}
    <button class="day-pill {% if loop.first %}active{% endif %}" data-day="{{ day }}">{{ day }}</button>
    {% endfor %}
  </div>
  <div class="schedule-content">
    <div class="schedule-list" id="scheduleList">
      {% if schedule.schedule %}
        {% set first_day = schedule.schedule.keys() | list | first %}
        {% for item in schedule.schedule[first_day][:8] %}
        <a href="/anime/{{ item.slug }}" class="schedule-item">
          <span class="schedule-time">{{ item.time if item.time else 'â€”' }}</span>
          <span>{{ item.title }}</span>
          {% if item.episode %}<span class="schedule-ep">{{ item.episode }}</span>{% endif %}
        </a>
        {% endfor %}
      {% endif %}
    </div>
  </div>
</div>

<script>
const scheduleData = {{ schedule.schedule | tojson | safe if schedule.schedule else '{}' }};
function activateDay(dayName) {
  const pills = document.querySelectorAll('.day-pill');
  let matched = false;
  pills.forEach(btn => {
    if (btn.dataset.day === dayName) {
      btn.classList.add('active');
      matched = true;
      const items = scheduleData[dayName] || [];
      const list = document.getElementById('scheduleList');
      list.innerHTML = items.slice(0, 8).map(item => `
        <a href="/anime/${item.slug}" class="schedule-item">
          <span class="schedule-time">${item.time || 'â€”'}</span>
          <span>${item.title}</span>
          ${item.episode ? `<span class="schedule-ep">${item.episode}</span>` : ''}
        </a>
      `).join('');
      btn.scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
    } else {
      btn.classList.remove('active');
    }
  });
  return matched;
}

document.querySelectorAll('.day-pill').forEach(btn => {
  btn.addEventListener('click', () => activateDay(btn.dataset.day));
});

// Auto-aktifkan hari ini
(function() {
  const hariMap = {
    0: 'Minggu', 1: 'Senin', 2: 'Selasa', 3: 'Rabu',
    4: 'Kamis', 5: 'Jumat', 6: 'Sabtu'
  };
  const today = hariMap[new Date().getDay()];
  if (!activateDay(today)) {
    // Fallback: aktifkan hari pertama kalau hari ini tidak ada di jadwal
    const first = document.querySelector('.day-pill');
    if (first) activateDay(first.dataset.day);
  }
})();
</script>
{% endif %}

<!-- ONGOING -->
{% if data and data.ongoing %}
<section class="section">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Sedang Tayang</h2>
      <a href="/ongoing" class="see-all">Lihat Semua â†’</a>
    </div>
    <div class="anime-grid ongoing-grid stagger">
      {% for anime in data.ongoing[:10] %}
      <a href="/anime/{{ anime.slug }}" class="anime-card">
        <div class="card-poster">
          <img src="{{ anime.poster }}" alt="{{ anime.title }}" loading="lazy" onerror="this.src='/static/img/placeholder.svg'">
          <div class="card-overlay">
            <div class="play-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>
            </div>
          </div>
          <span class="card-badge">{{ anime.episode }}</span>
          {% if anime.type %}<span class="card-badge type">{{ anime.type }}</span>{% endif %}
        </div>
        <div class="card-info">
          <div class="card-title">{{ anime.title }}</div>
          <div class="card-meta">
            <span class="card-ep">{{ anime.status_or_day }}</span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- POPULAR -->
{% if popular and popular.animes %}
<section class="section" style="padding-top:0">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">ðŸ”¥ Populer</h2>
      <a href="/popular" class="see-all">Lihat Semua â†’</a>
    </div>
    <div class="anime-grid lg stagger">
      {% for anime in popular.animes[:10] %}
      <a href="/anime/{{ anime.slug }}" class="anime-card">
        <div class="card-poster">
          <img src="{{ anime.poster }}" alt="{{ anime.title }}" loading="lazy" onerror="this.src='/static/img/placeholder.svg'">
          <div class="card-overlay">
            <div class="play-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>
            </div>
          </div>
          {% if anime.type %}<span class="card-badge type">{{ anime.type }}</span>{% endif %}
        </div>
        <div class="card-info">
          <div class="card-title">{{ anime.title }}</div>
          <div class="card-meta">
            <span class="card-ep">{{ anime.episode }}</span>
            <span class="card-status">{{ anime.status_or_day }}</span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

<!-- RECENT -->
{% if data and data.recent %}
<section class="section" style="padding-top:0">
  <div class="container">
    <div class="section-header">
      <h2 class="section-title">Terbaru</h2>
      <a href="/completed" class="see-all">Lihat Semua â†’</a>
    </div>
    <div class="anime-grid stagger">
      {% for anime in data.recent[:10] %}
      <a href="/anime/{{ anime.slug }}" class="anime-card">
        <div class="card-poster">
          <img src="{{ anime.poster }}" alt="{{ anime.title }}" loading="lazy" onerror="this.src='/static/img/placeholder.svg'">
          <div class="card-overlay">
            <div class="play-btn">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><path d="M5 3l14 9-14 9V3z"/></svg>
            </div>
          </div>
          {% if anime.type %}<span class="card-badge type">{{ anime.type }}</span>{% endif %}
        </div>
        <div class="card-info">
          <div class="card-title">{{ anime.title }}</div>
          <div class="card-meta">
            <span class="card-ep">{{ anime.episode }}</span>
            <span class="card-status">{{ anime.status_or_day }}</span>
          </div>
        </div>
      </a>
      {% endfor %}
    </div>
  </div>
</section>
{% endif %}

{% endblock %}
